<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}SmartRecipes{% endblock %}</title>
  
  <!-- PWA Manifest and Meta Tags -->
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <meta name="theme-color" content="#4CAF50">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="SmartRecipes">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
  <meta name="msapplication-TileImage" content="{{ url_for('static', filename='icons/icon-144x144.png') }}">
  <meta name="msapplication-TileColor" content="#4CAF50">
  
  <!-- Preload critical resources -->
  <link rel="preload" href="{{ url_for('static', filename='icons/icon-192x192.png') }}" as="image">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'sans': ['Inter', 'system-ui', 'sans-serif'],
            'heading': ['Poppins', 'system-ui', 'sans-serif'],
          },
          colors: {
            primary: {
              50: '#fef2f2',
              100: '#fee2e2',
              200: '#fecaca',
              300: '#fca5a5',
              400: '#f87171',
              500: '#ef4444',
              600: '#dc2626',
              700: '#b91c1c',
              800: '#991b1b',
              900: '#7f1d1d',
            },
            secondary: {
              50: '#f0fdfa',
              100: '#ccfbf1',
              200: '#99f6e4',
              300: '#5eead4',
              400: '#2dd4bf',
              500: '#14b8a6',
              600: '#0d9488',
              700: '#0f766e',
              800: '#115e59',
              900: '#134e4a',
            },
            accent: {
              50: '#fff7ed',
              100: '#ffedd5',
              200: '#fed7aa',
              300: '#fdba74',
              400: '#fb923c',
              500: '#f97316',
              600: '#ea580c',
              700: '#c2410c',
              800: '#9a3412',
              900: '#7c2d12',
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out',
            'fade-in-up': 'fadeInUp 0.6s ease-out',
            'slide-in-right': 'slideInRight 0.5s ease-out',
            'slide-in-left': 'slideInLeft 0.5s ease-out',
            'bounce-gentle': 'bounceGentle 2s ease-in-out infinite',
            'pulse-soft': 'pulseSoft 2s ease-in-out infinite',
            'wiggle': 'wiggle 1s ease-in-out infinite',
            'scale-in': 'scaleIn 0.3s ease-out',
            'float': 'float 3s ease-in-out infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' }
            },
            fadeInUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' }
            },
            slideInRight: {
              '0%': { opacity: '0', transform: 'translateX(20px)' },
              '100%': { opacity: '1', transform: 'translateX(0)' }
            },
            slideInLeft: {
              '0%': { opacity: '0', transform: 'translateX(-20px)' },
              '100%': { opacity: '1', transform: 'translateX(0)' }
            },
            bounceGentle: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-5px)' }
            },
            pulseSoft: {
              '0%, 100%': { transform: 'scale(1)' },
              '50%': { transform: 'scale(1.05)' }
            },
            wiggle: {
              '0%, 100%': { transform: 'rotate(-3deg)' },
              '50%': { transform: 'rotate(3deg)' }
            },
            scaleIn: {
              '0%': { transform: 'scale(0.9)', opacity: '0' },
              '100%': { transform: 'scale(1)', opacity: '1' }
            },
            float: {
              '0%, 100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-10px)' }
            }
          },
          backdropBlur: {
            'xs': '2px',
          },
          boxShadow: {
            'glow': '0 0 20px rgba(239, 68, 68, 0.3)',
            'glow-lg': '0 0 40px rgba(239, 68, 68, 0.2)',
            'inner-glow': 'inset 0 2px 4px 0 rgba(255, 255, 255, 0.1)',
          }
        }
      }
    }
  </script>

  <style>
    /* Enhanced scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #ef4444, #dc2626);
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #dc2626, #b91c1c);
    }

    /* Advanced glass morphism */
    .glass {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .glass-dark {
      background: rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Enhanced gradient text */
    .gradient-text {
      background: linear-gradient(135deg, #ef4444 0%, #f97316 50%, #eab308 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      background-size: 200% 200%;
      animation: gradientShift 3s ease infinite;
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    /* Advanced button effects */
    .btn-primary {
      position: relative;
      background: linear-gradient(135deg, #ef4444, #f97316);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .btn-primary:hover::before {
      left: 100%;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);
    }

    .btn-secondary {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .btn-secondary:hover {
      transform: translateY(-1px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    /* Navigation enhancements */
    .nav-link {
      position: relative;
      transition: all 0.3s ease;
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 50%;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #ef4444, #f97316);
      transition: all 0.3s ease;
      transform: translateX(-50%);
    }

    .nav-link:hover::after {
      width: 100%;
    }

    /* Enhanced notification styles */
    .notification {
      animation: slideInRight 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      backdrop-filter: blur(8px);
    }

    .notification-enter {
      transform: translateX(100%);
      opacity: 0;
    }

    .notification-enter-active {
      transform: translateX(0);
      opacity: 1;
      transition: all 0.3s ease-out;
    }

    /* Loading states */
    .loading-shimmer {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    /* Focus states for accessibility */
    .focus-ring:focus {
      outline: none;
      ring-offset: 2px;
      ring: 2px solid #ef4444;
      ring-offset-color: white;
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
      .mobile-optimized {
        font-size: 14px;
        padding: 0.75rem;
      }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      .auto-dark {
        background: #1f2937;
        color: #f9fafb;
      }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 min-h-screen font-sans antialiased">
  
  <!-- Navigation with enhanced design -->
  <nav class="sticky top-0 z-50 glass shadow-xl border-b border-white/30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        
        <!-- Enhanced Logo -->
        <a href="/" class="flex items-center space-x-3 group focus-ring rounded-lg px-2 py-1">
          <div class="relative">
            <i class="fas fa-utensils text-2xl gradient-text group-hover:animate-wiggle"></i>
            <div class="absolute inset-0 blur-sm opacity-30 group-hover:opacity-50 transition-opacity">
              <i class="fas fa-utensils text-2xl gradient-text"></i>
            </div>
          </div>
          <span class="text-2xl font-heading font-bold gradient-text group-hover:scale-105 transition-transform duration-300">
            SmartRecipes
          </span>
        </a>
        
        <!-- Enhanced Navigation Links -->
        <div class="hidden md:flex items-center space-x-6">
          <a href="/" class="nav-link text-gray-700 hover:text-primary-500 font-medium px-3 py-2 rounded-lg hover:bg-white/50 focus-ring">
            <i class="fas fa-home mr-1 text-sm"></i>
            <span>Home</span>
          </a>
          
          <a href="/input" class="nav-link text-gray-700 hover:text-primary-500 font-medium px-3 py-2 rounded-lg hover:bg-white/50 focus-ring">
            <i class="fas fa-search mr-1 text-sm"></i>
            <span>Find Recipes</span>
          </a>
          
          <!-- Enhanced User Authentication -->
          {% if session.get("user") %}
            <a href="/favorites" class="nav-link text-gray-700 hover:text-primary-500 font-medium px-3 py-2 rounded-lg hover:bg-white/50 focus-ring">
              <i class="fas fa-heart mr-1 text-sm text-primary-500"></i>
              <span>Favorites</span>
            </a>
            
            <div class="flex items-center space-x-3">
              <div class="glass px-4 py-2 rounded-full">
                <span class="text-sm text-gray-700">
                  <i class="fas fa-user mr-1"></i>
                  Welcome, <strong class="text-primary-600">{{ session['user'] }}</strong>
                </span>
              </div>
              <a href="/logout" class="btn-secondary bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium focus-ring">
                <i class="fas fa-sign-out-alt mr-1"></i>
                Logout
              </a>
            </div>
          {% else %}
            <div class="flex items-center space-x-4">
              <a href="/login" class="text-gray-700 hover:text-primary-500 font-medium px-3 py-2 rounded-lg hover:bg-white/50 focus-ring">
                <i class="fas fa-sign-in-alt mr-1"></i>
                Login
              </a>
              <a href="/register" class="btn-primary text-white px-6 py-2 rounded-lg font-semibold shadow-lg focus-ring">
                <i class="fas fa-user-plus mr-1"></i>
                Register
              </a>
            </div>
          {% endif %}
        </div>

        <!-- Enhanced Mobile menu button -->
        <div class="md:hidden">
          <button id="mobile-menu-btn" class="text-gray-700 hover:text-primary-500 p-2 rounded-lg hover:bg-white/50 transition-all focus-ring" aria-label="Toggle mobile menu">
            <i class="fas fa-bars text-xl"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Enhanced Mobile menu -->
    <div id="mobile-menu" class="hidden md:hidden glass-dark border-t border-white/20 animate-fade-in-up">
      <div class="px-4 py-4 space-y-2">
        <a href="/" class="flex items-center text-gray-700 hover:text-primary-500 font-medium py-3 px-3 rounded-lg hover:bg-white/20 transition-all focus-ring">
          <i class="fas fa-home mr-3"></i>Home
        </a>
        <a href="/input" class="flex items-center text-gray-700 hover:text-primary-500 font-medium py-3 px-3 rounded-lg hover:bg-white/20 transition-all focus-ring">
          <i class="fas fa-search mr-3"></i>Find Recipes
        </a>
        
        {% if session.get("user") %}
          <a href="/favorites" class="flex items-center text-gray-700 hover:text-primary-500 font-medium py-3 px-3 rounded-lg hover:bg-white/20 transition-all focus-ring">
            <i class="fas fa-heart mr-3 text-primary-500"></i>Favorites
          </a>
          <div class="pt-3 mt-3 border-t border-white/20">
            <div class="glass px-3 py-2 rounded-lg mb-3">
              <span class="text-sm text-gray-700">
                <i class="fas fa-user mr-2"></i>Welcome, <strong class="text-primary-600">{{ session['user'] }}</strong>
              </span>
            </div>
            <a href="/logout" class="flex items-center justify-center btn-secondary bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-3 rounded-lg font-medium focus-ring">
              <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </a>
          </div>
        {% else %}
          <div class="pt-3 mt-3 border-t border-white/20 space-y-3">
            <a href="/login" class="flex items-center justify-center text-gray-700 hover:text-primary-500 font-medium py-3 px-3 rounded-lg hover:bg-white/20 transition-all focus-ring">
              <i class="fas fa-sign-in-alt mr-2"></i>Login
            </a>
            <a href="/register" class="flex items-center justify-center btn-primary text-white px-4 py-3 rounded-lg font-semibold shadow-lg focus-ring">
              <i class="fas fa-user-plus mr-2"></i>Register
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </nav>

  <!-- Enhanced Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div id="flash-messages" class="fixed top-20 right-4 z-50 space-y-3">
        {% for category, msg in messages %}
          <div class="notification max-w-md glass {% if category == 'success' %}border-green-400 bg-green-500/90{% elif category == 'danger' %}border-red-400 bg-red-500/90{% elif category == 'warning' %}border-yellow-400 bg-yellow-500/90{% else %}border-blue-400 bg-blue-500/90{% endif %} text-white rounded-xl shadow-2xl border backdrop-blur-sm">
            <div class="flex items-start space-x-3 p-4">
              <div class="flex-shrink-0 pt-0.5">
                <i class="fas {% if category == 'success' %}fa-check-circle{% elif category == 'danger' %}fa-times-circle{% elif category == 'warning' %}fa-exclamation-triangle{% else %}fa-info-circle{% endif %} text-lg"></i>
              </div>
              <div class="flex-1 min-w-0">
                <p class="font-medium leading-5">{{ msg }}</p>
              </div>
              <button onclick="this.closest('.notification').remove()" class="flex-shrink-0 hover:bg-white/20 rounded-lg p-1.5 transition-colors focus-ring" aria-label="Dismiss notification">
                <i class="fas fa-times text-sm"></i>
              </button>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Main Content -->
  <main class="relative animate-fade-in">
    {% block content %}{% endblock %}
  </main>

  <!-- Enhanced Footer -->
  <footer class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white mt-20 relative overflow-hidden">
    <!-- Background decoration -->
    <div class="absolute inset-0 opacity-5">
      <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-r from-primary-500/20 to-accent-500/20"></div>
    </div>
    
    <div class="relative max-w-7xl mx-auto px-4 py-16">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-12">
        <div class="col-span-2">
          <div class="flex items-center space-x-3 mb-6">
            <i class="fas fa-utensils text-3xl text-primary-500 animate-float"></i>
            <span class="text-3xl font-heading font-bold gradient-text">SmartRecipes</span>
          </div>
          <p class="text-gray-300 mb-6 text-lg leading-relaxed">
            Discover delicious recipes based on the ingredients you have. Transform your kitchen into a culinary adventure with AI-powered recipe recommendations!
          </p>
          <div class="flex space-x-4">
            <a href="#" class="glass-dark text-gray-300 hover:text-primary-500 p-3 rounded-full transition-all hover:scale-110 focus-ring" aria-label="Facebook">
              <i class="fab fa-facebook-f text-xl"></i>
            </a>
            <a href="#" class="glass-dark text-gray-300 hover:text-primary-500 p-3 rounded-full transition-all hover:scale-110 focus-ring" aria-label="Twitter">
              <i class="fab fa-twitter text-xl"></i>
            </a>
            <a href="#" class="glass-dark text-gray-300 hover:text-primary-500 p-3 rounded-full transition-all hover:scale-110 focus-ring" aria-label="Instagram">
              <i class="fab fa-instagram text-xl"></i>
            </a>
            <a href="#" class="glass-dark text-gray-300 hover:text-primary-500 p-3 rounded-full transition-all hover:scale-110 focus-ring" aria-label="YouTube">
              <i class="fab fa-youtube text-xl"></i>
            </a>
          </div>
        </div>
        
        <div>
          <h3 class="font-semibold mb-6 text-xl text-primary-400">Quick Links</h3>
          <ul class="space-y-3">
            <li><a href="/" class="text-gray-300 hover:text-white transition-colors flex items-center focus-ring rounded px-2 py-1"><i class="fas fa-home mr-2 text-sm"></i>Home</a></li>
            <li><a href="/input" class="text-gray-300 hover:text-white transition-colors flex items-center focus-ring rounded px-2 py-1"><i class="fas fa-search mr-2 text-sm"></i>Find Recipes</a></li>
            {% if session.get('user') %}
            <li><a href="/favorites" class="text-gray-300 hover:text-white transition-colors flex items-center focus-ring rounded px-2 py-1"><i class="fas fa-heart mr-2 text-sm"></i>My Favorites</a></li>
            {% endif %}
          </ul>
        </div>
        
        <div>
          <h3 class="font-semibold mb-6 text-xl text-secondary-400">Support</h3>
          <ul class="space-y-3">
            <li><a href="#" class="text-gray-300 hover:text-white transition-colors flex items-center focus-ring rounded px-2 py-1"><i class="fas fa-question-circle mr-2 text-sm"></i>Help Center</a></li>
            <li><a href="#" class="text-gray-300 hover:text-white transition-colors flex items-center focus-ring rounded px-2 py-1"><i class="fas fa-envelope mr-2 text-sm"></i>Contact Us</a></li>
            <li><a href="#" class="text-gray-300 hover:text-white transition-colors flex items-center focus-ring rounded px-2 py-1"><i class="fas fa-shield-alt mr-2 text-sm"></i>Privacy Policy</a></li>
            <li><a href="#" class="text-gray-300 hover:text-white transition-colors flex items-center focus-ring rounded px-2 py-1"><i class="fas fa-file-contract mr-2 text-sm"></i>Terms of Service</a></li>
          </ul>
        </div>
      </div>
      
      <div class="border-t border-gray-700 pt-8 text-center">
        <p class="text-gray-400">
          &copy; 2025 SmartRecipes. Made with <i class="fas fa-heart text-primary-500 mx-1 animate-pulse-soft"></i> for food lovers everywhere.
        </p>
      </div>
    </div>
  </footer>

  <!-- Enhanced JavaScript -->
  <script>
    // Enhanced mobile menu with animations
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (mobileMenuBtn && mobileMenu) {
      mobileMenuBtn.addEventListener('click', () => {
        const isHidden = mobileMenu.classList.contains('hidden');
        
        if (isHidden) {
          mobileMenu.classList.remove('hidden');
          mobileMenu.style.maxHeight = '0';
          mobileMenu.style.overflow = 'hidden';
          requestAnimationFrame(() => {
            mobileMenu.style.transition = 'max-height 0.3s ease-out';
            mobileMenu.style.maxHeight = mobileMenu.scrollHeight + 'px';
          });
        } else {
          mobileMenu.style.maxHeight = '0';
          setTimeout(() => {
            mobileMenu.classList.add('hidden');
            mobileMenu.style.maxHeight = '';
            mobileMenu.style.overflow = '';
            mobileMenu.style.transition = '';
          }, 300);
        }
        
        // Toggle icon
        const icon = mobileMenuBtn.querySelector('i');
        icon.classList.toggle('fa-bars');
        icon.classList.toggle('fa-times');
      });
    }

    // Enhanced flash message handling
    function dismissNotification(element) {
      element.style.transform = 'translateX(100%)';
      element.style.opacity = '0';
      setTimeout(() => element.remove(), 300);
    }

    // Auto-dismiss flash messages with enhanced timing
    setTimeout(() => {
      const flashMessages = document.querySelectorAll('.notification');
      flashMessages.forEach((msg, index) => {
        setTimeout(() => {
          dismissNotification(msg);
        }, index * 200); // Stagger dismissals
      });
    }, 6000);

    // Enhanced smooth scroll with easing
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          const targetPosition = target.offsetTop - 80; // Account for sticky nav
          window.scrollTo({
            top: targetPosition,
            behavior: 'smooth'
          });
        }
      });
    });

    // Keyboard navigation support
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        // Close mobile menu on escape
        if (!mobileMenu.classList.contains('hidden')) {
          mobileMenuBtn.click();
        }
        
        // Dismiss notifications on escape
        const notifications = document.querySelectorAll('.notification');
        notifications.forEach(notification => {
          dismissNotification(notification);
        });
      }
    });

    // Performance: Lazy load heavy content
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '50px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-fade-in-up');
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    // Observe elements for lazy animation
    document.querySelectorAll('.lazy-animate').forEach(el => {
      observer.observe(el);
    });

    // Add loading states for better UX
    document.querySelectorAll('form').forEach(form => {
      form.addEventListener('submit', (e) => {
        const submitBtn = form.querySelector('button[type="submit"], input[type="submit"]');
        if (submitBtn && !submitBtn.disabled) {
          submitBtn.disabled = true;
          submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Loading...';
          
          // Re-enable after timeout as fallback
          setTimeout(() => {
            submitBtn.disabled = false;
            submitBtn.innerHTML = submitBtn.dataset.originalText || 'Submit';
          }, 10000);
        }
      });
    });

    // Enhanced focus management for accessibility
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        document.body.classList.add('keyboard-navigation');
      }
    });

    document.addEventListener('mousedown', () => {
      document.body.classList.remove('keyboard-navigation');
    });
  </script>

  <!-- PWA Service Worker Registration and Install Prompt -->
  <script>
    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const registration = await navigator.serviceWorker.register('/static/sw.js');
          console.log('✅ Service Worker registered successfully:', registration.scope);
          
          // Check for updates
          registration.addEventListener('updatefound', () => {
            console.log('🔄 Service Worker update found!');
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // Show update notification
                showUpdateNotification();
              }
            });
          });
          
        } catch (error) {
          console.log('❌ Service Worker registration failed:', error);
        }
      });
    }

    // PWA Install Prompt
    let deferredPrompt;
    let installButton;

    // Listen for the beforeinstallprompt event
    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('📱 PWA install prompt available');
      // Prevent the mini-infobar from appearing on mobile
      e.preventDefault();
      // Stash the event so it can be triggered later
      deferredPrompt = e;
      // Show install button
      showInstallButton();
    });

    // Handle install button click
    function handleInstall() {
      if (!deferredPrompt) return;
      
      // Show the install prompt
      deferredPrompt.prompt();
      
      // Wait for the user to respond to the prompt
      deferredPrompt.userChoice.then((choiceResult) => {
        console.log('👤 User choice:', choiceResult.outcome);
        if (choiceResult.outcome === 'accepted') {
          console.log('✅ User accepted the install prompt');
          // Track install success
          if (typeof gtag !== 'undefined') {
            gtag('event', 'pwa_install', { value: 1 });
          }
        } else {
          console.log('❌ User dismissed the install prompt');
        }
        // Hide install button
        hideInstallButton();
        deferredPrompt = null;
      });
    }

    // Show install button
    function showInstallButton() {
      // Create install button if it doesn't exist
      if (!installButton) {
        installButton = document.createElement('div');
        installButton.innerHTML = `
          <div class="fixed bottom-4 right-4 z-50 animate-slide-in-right">
            <div class="glass bg-primary-500/95 text-white rounded-xl shadow-xl border border-white/20 p-5 max-w-sm">
              <div class="flex items-start space-x-3">
                <div class="flex-shrink-0">
                  <i class="fas fa-mobile-alt text-2xl text-yellow-300"></i>
                </div>
                <div class="flex-1">
                  <h4 class="font-bold mb-2 text-lg">Add to Home Screen</h4>
                  <p class="text-sm text-white/95 mb-3 leading-relaxed">
                    This creates a native app-like shortcut on your device. <strong>No download needed!</strong> 
                    It's a modern web app that works offline and loads instantly.
                  </p>
                  <div class="bg-white/10 rounded-lg p-3 mb-3 text-xs text-white/90">
                    ✅ Works offline &bull; ✅ No app store required &bull; ✅ Instant loading
                  </div>
                  <div class="flex flex-col space-y-2">
                    <div class="flex space-x-2">
                      <button onclick="handleInstall()" class="bg-white text-primary-600 px-4 py-2.5 rounded-lg font-bold text-sm hover:bg-white/95 transition-colors flex items-center">
                        <i class="fas fa-plus mr-1"></i>Add to Home Screen
                      </button>
                      <button onclick="hideInstallButton()" class="text-white/90 hover:text-white px-3 py-2 text-sm transition-colors">
                        Not now
                      </button>
                    </div>
                    <a href="/pwa-info" class="text-center text-xs text-white/80 hover:text-white underline transition-colors">
                      What is this? Learn more about web apps
                    </a>
                  </div>
                </div>
                <button onclick="hideInstallButton()" class="flex-shrink-0 text-white/60 hover:text-white transition-colors p-1">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(installButton);
      } else {
        installButton.style.display = 'block';
      }
      
      // Auto-hide after 10 seconds
      setTimeout(() => {
        if (installButton) {
          hideInstallButton();
        }
      }, 10000);
    }

    // Hide install button
    function hideInstallButton() {
      if (installButton) {
        installButton.style.display = 'none';
      }
    }

    // Show update notification
    function showUpdateNotification() {
      const updateNotification = document.createElement('div');
      updateNotification.innerHTML = `
        <div class="fixed top-20 right-4 z-50 max-w-md">
          <div class="notification glass bg-blue-500/90 border-blue-400 text-white rounded-xl shadow-2xl border backdrop-blur-sm">
            <div class="flex items-start space-x-3 p-4">
              <div class="flex-shrink-0 pt-0.5">
                <i class="fas fa-sync-alt text-lg"></i>
              </div>
              <div class="flex-1 min-w-0">
                <p class="font-medium leading-5">Update Available!</p>
                <p class="text-sm text-white/90 mt-1">A new version of SmartRecipes is ready.</p>
                <button onclick="window.location.reload()" class="mt-2 bg-white text-blue-600 px-3 py-1 rounded text-sm font-medium hover:bg-white/90 transition-colors">
                  <i class="fas fa-refresh mr-1"></i>Update Now
                </button>
              </div>
              <button onclick="this.closest('.notification').remove()" class="flex-shrink-0 hover:bg-white/20 rounded-lg p-1.5 transition-colors">
                <i class="fas fa-times text-sm"></i>
              </button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(updateNotification);
      
      // Auto-remove after 15 seconds
      setTimeout(() => {
        updateNotification.remove();
      }, 15000);
    }

    // Check if app is installed
    window.addEventListener('appinstalled', (evt) => {
      console.log('✅ SmartRecipes PWA was installed successfully!');
      // Track successful installation
      if (typeof gtag !== 'undefined') {
        gtag('event', 'pwa_installed', { value: 1 });
      }
      // Hide install button if still showing
      hideInstallButton();
    });

    // Detect if running as PWA
    function isPWA() {
      return window.matchMedia('(display-mode: standalone)').matches || 
             window.navigator.standalone || 
             document.referrer.includes('android-app://');
    }

    // Add PWA-specific styling
    if (isPWA()) {
      console.log('🎉 Running as PWA!');
      document.body.classList.add('pwa-mode');
      
      // Add PWA-specific styles
      const pwaStyles = document.createElement('style');
      pwaStyles.textContent = `
        .pwa-mode {
          padding-top: env(safe-area-inset-top);
          padding-bottom: env(safe-area-inset-bottom);
        }
        .pwa-mode nav {
          padding-top: env(safe-area-inset-top);
        }
      `;
      document.head.appendChild(pwaStyles);
    }

    // Network status handling
    function updateOnlineStatus() {
      const status = navigator.onLine ? 'online' : 'offline';
      console.log('🌐 Network status:', status);
      
      if (!navigator.onLine) {
        // Show offline notification
        showOfflineNotification();
      }
    }

    function showOfflineNotification() {
      // Only show if not already showing
      if (document.querySelector('.offline-notification')) return;
      
      const offlineNotification = document.createElement('div');
      offlineNotification.className = 'offline-notification';
      offlineNotification.innerHTML = `
        <div class="fixed bottom-4 left-4 z-50">
          <div class="glass bg-yellow-500/90 border-yellow-400 text-white rounded-lg shadow-xl border backdrop-blur-sm p-3">
            <div class="flex items-center space-x-2">
              <i class="fas fa-wifi text-sm"></i>
              <span class="text-sm font-medium">You're offline</span>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(offlineNotification);
      
      // Remove when back online
      const handleOnline = () => {
        offlineNotification.remove();
        window.removeEventListener('online', handleOnline);
      };
      window.addEventListener('online', handleOnline);
    }

    // Listen for online/offline events
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    
    // Initial network status check
    updateOnlineStatus();

    // Cache management functions
    window.clearAppCache = async function() {
      if ('caches' in window) {
        const cacheNames = await caches.keys();
        await Promise.all(
          cacheNames.map(cacheName => caches.delete(cacheName))
        );
        console.log('🗑️ App cache cleared');
        window.location.reload();
      }
    };

    // Performance monitoring
    window.addEventListener('load', () => {
      if ('performance' in window) {
        const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
        console.log('⚡ Page load time:', loadTime + 'ms');
        
        // Track performance if analytics available
        if (typeof gtag !== 'undefined') {
          gtag('event', 'page_load_time', {
            value: Math.round(loadTime),
            metric_id: 'LCP'
          });
        }
      }
    });
  </script>

  <!-- Add this CSS for keyboard navigation visibility -->
  <style>
    body:not(.keyboard-navigation) .focus-ring:focus {
      box-shadow: none;
      outline: none;
    }
  </style>

</body>
</html>