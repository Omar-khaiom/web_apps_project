{% extends "layout.html" %}
{% block title %}My Favorites | SmartRecipes{% endblock %}
{% block content %}
<!-- Animated Background Elements -->
<div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
  <div class="floating-heart absolute top-20 left-10 text-pink-200 opacity-30">
    <i class="fas fa-heart text-4xl animate-pulse"></i>
  </div>
  <div class="floating-heart absolute top-40 right-20 text-red-200 opacity-20" style="animation-delay: 1s;">
    <i class="fas fa-heart text-3xl animate-pulse"></i>
  </div>
  <div class="floating-heart absolute bottom-32 left-1/4 text-pink-300 opacity-25" style="animation-delay: 2s;">
    <i class="fas fa-heart text-5xl animate-pulse"></i>
  </div>
  <div class="floating-heart absolute top-1/3 right-1/3 text-red-300 opacity-15" style="animation-delay: 0.5s;">
    <i class="fas fa-heart text-2xl animate-pulse"></i>
  </div>
</div>

<!-- Enhanced Favorites Section -->
<section class="min-h-screen py-12 relative z-10">
  <div class="max-w-7xl mx-auto px-4">
    <!-- Animated Header Section -->
    <div class="text-center mb-12 animate-fade-in-up">
      <div class="relative inline-block mb-6">
        <!-- Animated gradient background -->
        <div class="absolute inset-0 bg-gradient-to-r from-pink-400 via-red-500 to-orange-500 rounded-3xl blur-lg opacity-30 animate-pulse"></div>
        
        <div class="relative inline-flex items-center space-x-4 bg-white/90 backdrop-blur-sm rounded-3xl p-6 shadow-2xl border border-white/50">
          <div class="w-20 h-20 bg-gradient-to-br from-red-500 via-pink-500 to-orange-500 rounded-2xl flex items-center justify-center shadow-2xl animate-bounce" style="animation-duration: 2s;">
            <i class="fas fa-heart text-white text-3xl animate-pulse"></i>
          </div>
          <div>
            <h1 class="text-4xl md:text-6xl font-heading font-bold bg-gradient-to-r from-red-600 via-pink-600 to-orange-600 bg-clip-text text-transparent">
              My Favorite Recipes
            </h1>
            <div class="flex items-center justify-center space-x-2 mt-2">
              <span class="animate-bounce" style="animation-delay: 0.1s;">üíñ</span>
              <span class="animate-bounce" style="animation-delay: 0.2s;">‚ú®</span>
              <span class="animate-bounce" style="animation-delay: 0.3s;">üç≥</span>
              <span class="animate-bounce" style="animation-delay: 0.4s;">‚ú®</span>
              <span class="animate-bounce" style="animation-delay: 0.5s;">üíñ</span>
            </div>
          </div>
        </div>
      </div>
      
      <p class="text-xl text-gray-700 max-w-3xl mx-auto leading-relaxed font-medium animate-fade-in-up" style="animation-delay: 0.3s;">
        Your personally curated collection of <span class="text-pink-600 font-bold">delicious recipes</span>, 
        saved with love and ready to inspire your next culinary adventure! ‚ù§Ô∏è‚ú®
      </p>
      
      <!-- Recipe count badge -->
      {% if favorites %}
      <div class="inline-flex items-center space-x-2 mt-4 bg-gradient-to-r from-pink-100 to-red-100 rounded-full px-6 py-3 animate-fade-in-up" style="animation-delay: 0.5s;">
        <i class="fas fa-utensils text-pink-600"></i>
        <span class="font-semibold text-pink-800">{{ favorites|length }} Recipe{{ 's' if favorites|length != 1 else '' }} Saved</span>
        <i class="fas fa-sparkles text-pink-600 animate-pulse"></i>
      </div>
      {% endif %}
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-wrap justify-center gap-4 mb-8 animate-fade-in-up" style="animation-delay: 0.2s;">
      <button 
        onclick="addSampleRecipe()" 
        class="group bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 hover:shadow-lg hover:-translate-y-1 flex items-center space-x-2"
      >
        <i class="fas fa-plus group-hover:animate-bounce"></i>
        <span>Add Sample Recipe</span>
      </button>
      
      {% if favorites %}
      <button 
        onclick="clearAllFavorites()" 
        class="group bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 hover:shadow-lg hover:-translate-y-1 flex items-center space-x-2"
      >
        <i class="fas fa-trash group-hover:animate-shake"></i>
        <span>Clear All Favorites</span>
      </button>
      {% endif %}
    </div>

    <!-- Favorites Grid -->
    {% if favorites %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 animate-fade-in-up" style="animation-delay: 0.4s;" id="favorites-grid">
      {% for favorite in favorites %}
      <div class="group glass-card rounded-3xl overflow-hidden shadow-xl hover:shadow-2xl transition-all duration-500 hover:-translate-y-3 hover:scale-105 recipe-card transform-gpu" data-recipe-id="{{ favorite.recipe_id }}" style="animation: slideInUp 0.6s ease-out {{ loop.index0 * 0.1 }}s both;">
        <!-- Sparkle effects -->
        <div class="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none z-10">
          <div class="absolute top-4 left-4 w-2 h-2 bg-yellow-300 rounded-full animate-ping" style="animation-delay: 0.2s;"></div>
          <div class="absolute top-8 right-8 w-1 h-1 bg-pink-300 rounded-full animate-ping" style="animation-delay: 0.5s;"></div>
          <div class="absolute bottom-12 left-6 w-1.5 h-1.5 bg-blue-300 rounded-full animate-ping" style="animation-delay: 0.8s;"></div>
        </div>
        
        <!-- Image Section -->
        <div class="relative overflow-hidden">
          <img 
            src="{{ favorite.recipe_image | default('https://via.placeholder.com/300x200?text=Recipe') }}" 
            alt="{{ favorite.recipe_title }}" 
            class="w-full h-52 object-cover transition-all duration-700 group-hover:scale-110 group-hover:brightness-110"
            loading="lazy"
          >
          
          <!-- Animated gradient overlay -->
          <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-pink-500/10 opacity-0 group-hover:opacity-100 transition-all duration-500"></div>
          
          <!-- Love heart animation -->
          <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300">
            <div class="w-16 h-16 text-red-400 animate-pulse">
              <i class="fas fa-heart text-4xl drop-shadow-lg"></i>
            </div>
          </div>
          
          <!-- Enhanced remove button -->
          <button 
            onclick="toggleFavorite({{ favorite.recipe_id }}, '{{ favorite.recipe_title | replace('\'', '\\\'') }}', '{{ favorite.recipe_image | default('https://via.placeholder.com/300') | replace('\'', '\\\'') }}')"
            class="absolute top-4 right-4 w-12 h-12 bg-gradient-to-br from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110 shadow-lg opacity-0 group-hover:opacity-100 hover:rotate-12"
            title="Remove from favorites"
          >
            <i class="fas fa-heart-broken text-lg"></i>
          </button>
          
          <!-- Enhanced date badge -->
          <div class="absolute bottom-4 left-4 glass-vibrant px-4 py-2 rounded-full text-white text-sm font-semibold backdrop-blur-md border border-white/20">
            <i class="fas fa-calendar-heart mr-2 text-pink-300"></i>
            Saved {{ favorite.saved_at[:10] if favorite.saved_at else 'Unknown' }}
          </div>
          
          <!-- Favorite indicator -->
          <div class="absolute top-4 left-4 w-8 h-8 bg-red-500 rounded-full flex items-center justify-center animate-pulse">
            <i class="fas fa-heart text-white text-sm"></i>
          </div>
        </div>

        <!-- Enhanced Content Section -->
        <div class="p-6 bg-gradient-to-br from-white to-gray-50 relative">
          <!-- Decorative element -->
          <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-pink-500 via-red-500 to-orange-500 opacity-60 group-hover:opacity-100 transition-opacity duration-300"></div>
          
          <h3 class="text-xl font-heading font-bold text-gray-900 mb-4 line-clamp-2 group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-blue-600 group-hover:to-purple-600 transition-all duration-300">
            {{ favorite.recipe_title }}
          </h3>
          
          <!-- Recipe stats -->
          <div class="flex items-center space-x-4 mb-4 text-sm text-gray-600">
            <div class="flex items-center space-x-1">
              <i class="fas fa-utensils text-pink-500"></i>
              <span>Recipe</span>
            </div>
            <div class="flex items-center space-x-1">
              <i class="fas fa-heart text-red-500 animate-pulse"></i>
              <span>Favorite</span>
            </div>
            <div class="flex items-center space-x-1">
              <i class="fas fa-star text-yellow-500"></i>
              <span>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
            </div>
          </div>
          
          <!-- Enhanced Action Buttons -->
          <div class="flex gap-3">
            <a 
              href="{{ url_for('recipe_detail', recipe_id=favorite.recipe_id) }}" 
              class="flex-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 hover:from-blue-600 hover:via-purple-600 hover:to-pink-600 text-white font-bold py-3 px-4 rounded-2xl transition-all duration-300 hover:shadow-xl hover:-translate-y-1 text-center flex items-center justify-center space-x-2 group/btn"
            >
              <i class="fas fa-utensils group-hover/btn:animate-bounce"></i>
              <span>View Recipe</span>
              <i class="fas fa-arrow-right opacity-0 group-hover/btn:opacity-100 transition-all duration-300 transform group-hover/btn:translate-x-1"></i>
            </a>
          </div>
          
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="text-center py-20 animate-fade-in-up" style="animation-delay: 0.4s;">
      <div class="glass rounded-3xl p-12 max-w-2xl mx-auto">
        <div class="w-24 h-24 bg-gradient-to-r from-gray-400 to-gray-500 rounded-full flex items-center justify-center mx-auto mb-6">
          <i class="fas fa-heart text-white text-3xl opacity-50"></i>
        </div>
        
        <h3 class="text-3xl font-heading font-bold text-gray-800 mb-4">No Favorites Yet</h3>
        <p class="text-gray-600 mb-8 text-lg leading-relaxed">
          Start exploring our delicious recipes and save the ones that make your heart skip a beat! ‚ù§Ô∏è
        </p>
        
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <button 
            onclick="addSampleRecipe()" 
            class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 hover:shadow-lg hover:-translate-y-1 flex items-center justify-center space-x-2"
          >
            <i class="fas fa-plus"></i>
            <span>Add Sample Recipe</span>
          </button>
          
          <a 
            href="{{ url_for('input_page') }}" 
            class="bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 hover:shadow-lg hover:-translate-y-1 flex items-center justify-center space-x-2"
          >
            <i class="fas fa-search"></i>
            <span>Find Recipes</span>
          </a>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</section>

<!-- Toast notification container -->
<div id="toast-container" class="fixed top-4 right-4 space-y-2 z-50"></div>

<script>
  // Enhanced JavaScript functions
  async function addSampleRecipe() {
    const sampleRecipe = {
      recipe_id: 12345,
      recipe_title: "Sample Delicious Recipe",
      recipe_image: "https://via.placeholder.com/300x200?text=Sample+Recipe"
    };

    try {
      const response = await fetch('/toggle-favorite', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(sampleRecipe)
      });

      const result = await response.json();
      if (response.ok) {
        showToast(result.favorited ? 'Sample recipe added! ‚ù§Ô∏è' : 'Recipe removed', result.favorited ? 'success' : 'info');
        setTimeout(() => window.location.reload(), 1000);
      } else {
        showToast(result.error || 'Failed to add recipe', 'error');
      }
    } catch (error) {
      console.error('Error:', error);
      showToast('An error occurred', 'error');
    }
  }

  async function toggleFavorite(recipeId, recipeTitle, recipeImage) {
    try {
      const response = await fetch('/toggle-favorite', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          recipe_id: recipeId,
          recipe_title: recipeTitle,
          recipe_image: recipeImage
        })
      });

      const result = await response.json();
      if (response.ok) {
        showToast(result.favorited ? 'Added to favorites! ‚ù§Ô∏è' : 'Removed from favorites', result.favorited ? 'success' : 'info');
        
        // Remove the card with animation
        const card = document.querySelector(`[data-recipe-id="${recipeId}"]`);
        if (card && !result.favorited) {
          card.style.transform = 'scale(0)';
          card.style.opacity = '0';
          setTimeout(() => {
            card.remove();
            // Check if no more favorites
            if (!document.querySelectorAll('.recipe-card').length) {
              setTimeout(() => window.location.reload(), 500);
            }
          }, 300);
        }
      } else {
        showToast(result.error || 'Failed to update favorite', 'error');
      }
    } catch (error) {
      console.error('Error:', error);
      showToast('An error occurred', 'error');
    }
  }

  async function clearAllFavorites() {
    if (!confirm('Are you sure you want to remove all favorite recipes? This cannot be undone.')) {
      return;
    }

    try {
      const response = await fetch('/clear-favorites', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });

      const result = await response.json();
      if (response.ok) {
        showToast('All favorites cleared successfully', 'success');
        setTimeout(() => window.location.reload(), 1000);
      } else {
        showToast(result.error || 'Failed to clear favorites', 'error');
      }
    } catch (error) {
      console.error('Error:', error);
      showToast('An error occurred', 'error');
    }
  }

  // Toast notifications
  function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    
    const colors = {
      success: 'from-green-500 to-emerald-500',
      error: 'from-red-500 to-pink-500',
      info: 'from-blue-500 to-purple-500'
    };
    
    const icons = {
      success: 'fas fa-check-circle',
      error: 'fas fa-exclamation-circle',
      info: 'fas fa-info-circle'
    };
    
    toast.className = `flex items-center space-x-3 bg-gradient-to-r ${colors[type]} text-white px-6 py-4 rounded-xl shadow-lg transform translate-x-full transition-transform duration-300`;
    toast.innerHTML = `
      <i class="${icons[type]}"></i>
      <span class="font-medium">${message}</span>
      <button onclick="this.parentElement.remove()" class="ml-2 hover:bg-white/20 rounded-full p-1 transition-colors">
        <i class="fas fa-times text-sm"></i>
      </button>
    `;
    
    container.appendChild(toast);
    
    // Animate in
    setTimeout(() => toast.style.transform = 'translateX(0)', 100);
    
    // Auto remove
    setTimeout(() => {
      toast.style.transform = 'translateX(100%)';
      setTimeout(() => toast.remove(), 300);
    }, 4000);
  }
</script>

<style>
/* Enhanced Animations */
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
  20%, 40%, 60%, 80% { transform: translateX(2px); }
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(60px) scale(0.8);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  33% { transform: translateY(-10px) rotate(-2deg); }
  66% { transform: translateY(-5px) rotate(2deg); }
}

@keyframes heartbeat {
  0% { transform: scale(1); }
  14% { transform: scale(1.1); }
  28% { transform: scale(1); }
  42% { transform: scale(1.1); }
  70% { transform: scale(1); }
}

@keyframes sparkle {
  0%, 100% { opacity: 0; transform: scale(0); }
  50% { opacity: 1; transform: scale(1); }
}

@keyframes rainbow {
  0% { filter: hue-rotate(0deg); }
  100% { filter: hue-rotate(360deg); }
}

/* Animation Classes */
.animate-shake {
  animation: shake 0.5s ease-in-out;
}

.floating-heart {
  animation: float 6s ease-in-out infinite;
}

.animate-heartbeat {
  animation: heartbeat 2s ease-in-out infinite;
}

.animate-sparkle {
  animation: sparkle 1.5s ease-in-out infinite;
}

/* Glass Effects */
.glass-card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.6);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.glass {
  background: rgba(255, 255, 255, 0.25);
  backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.4);
}

.glass-vibrant {
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(15px) saturate(150%);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

/* Enhanced Visual Effects */
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.recipe-card {
  position: relative;
  overflow: hidden;
}

.recipe-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  transition: left 0.8s;
  z-index: 1;
  pointer-events: none;
}

.recipe-card:hover::before {
  left: 100%;
}

/* Hover Effects */
.group:hover .group-hover\:animate-bounce {
  animation: bounce 1s infinite;
}

.transform-gpu {
  transform: translateZ(0);
  will-change: transform;
}

/* Responsive Design */
@media (max-width: 768px) {
  .floating-heart {
    display: none;
  }
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.1);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(45deg, #ff5252, #ff7979);
}

/* Loading Animation for Images */
.recipe-card img {
  transition: all 0.3s ease;
}

.recipe-card img:not([src]), .recipe-card img[src=""] {
  background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
  background-size: 400% 400%;
  animation: shimmer 1.5s ease-in-out infinite;
}

@keyframes shimmer {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Enhanced Button Effects */
button, .btn {
  position: relative;
  overflow: hidden;
}

button:active, .btn:active {
  transform: scale(0.98);
}

/* Focus states for accessibility */
*:focus-visible {
  outline: 2px solid #ff6b6b;
  outline-offset: 2px;
  border-radius: 4px;
}

/* Print styles */
@media print {
  .floating-heart,
  #toast-container,
  button:not(.print-friendly) {
    display: none !important;
  }
}
</style>
{% endblock %}
