<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SmartRecipes</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        .splash { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; z-index: 9999;
        }
        .logo { font-size: 3rem; margin-bottom: 1rem; }
        .spinner { 
            border: 3px solid rgba(255,255,255,0.3); 
            border-radius: 50%; 
            border-top: 3px solid white; 
            width: 40px; height: 40px; 
            animation: spin 1s linear infinite; 
            margin: 1rem 0; 
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        .status { margin-top: 1rem; font-size: 0.9rem; opacity: 0.9; text-align: center; }
        .app-frame { width: 100%; height: 100vh; border: none; display: none; }
        .error-screen { display: none; padding: 2rem; text-align: center; }
        .retry-btn { 
            background: #4CAF50; color: white; border: none; padding: 12px 24px;
            border-radius: 5px; font-size: 1rem; margin-top: 1rem; cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="splash" class="splash">
        <div class="logo">üç≥</div>
        <h1>SmartRecipes</h1>
        <div class="spinner"></div>
        <div id="status" class="status">Connecting to server...</div>
    </div>
    
    <div id="error-screen" class="error-screen">
        <h2>Connection Failed</h2>
        <p id="error-message">Unable to connect to the server</p>
        <button id="retry-btn" class="retry-btn" onclick="connectToServer()">Retry Connection</button>
    </div>
    
    <iframe id="app-frame" class="app-frame" src="about:blank"></iframe>
    
    <script>
        let serverUrls = [
            'http://192.168.0.100:5000',
            'http://localhost:5000',
            'http://127.0.0.1:5000',
            'http://192.168.1.100:5000',
            'http://10.0.0.100:5000'
        ];
        
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        function showError(message) {
            document.getElementById('splash').style.display = 'none';
            document.getElementById('error-screen').style.display = 'block';
            document.getElementById('error-message').textContent = message;
        }
        
        function showApp(url) {
            const frame = document.getElementById('app-frame');
            frame.src = url;
            frame.onload = function() {
                document.getElementById('splash').style.display = 'none';
                frame.style.display = 'block';
            };
        }
        
        async function testServer(url) {
            try {
                updateStatus('Trying ' + url + '...');
                const response = await fetch(url, { 
                    method: 'GET',
                    mode: 'no-cors',
                    timeout: 5000 
                });
                return true;
            } catch (error) {
                return false;
            }
        }
        
        async function connectToServer() {
            document.getElementById('error-screen').style.display = 'none';
            document.getElementById('splash').style.display = 'flex';
            
            for (let i = 0; i < serverUrls.length; i++) {
                const url = serverUrls[i];
                const isReachable = await testServer(url);
                
                if (isReachable) {
                    updateStatus('Connected! Loading app...');
                    showApp(url);
                    return;
                }
            }
            
            showError('Could not connect to any server. Make sure your Flask app is running with --network flag.');
        }
        
        // Handle Android back button
        document.addEventListener('backbutton', function(e) {
            const frame = document.getElementById('app-frame');
            if (frame.style.display === 'block') {
                try {
                    frame.contentWindow.history.back();
                } catch (err) {
                    navigator.app.exitApp();
                }
            } else {
                navigator.app.exitApp();
            }
            e.preventDefault();
        }, false);
        
        // Start connection when device is ready
        document.addEventListener('deviceready', connectToServer, false);
        
        // For browser testing
        if (!window.cordova) {
            setTimeout(connectToServer, 1000);
        }
    </script>
    
    <script src="cordova.js"></script>
</body>
</html>
